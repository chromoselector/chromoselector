<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="../libs/jquery-1.8.1.js" type="text/javascript"></script>
    <script src="../color-picker.js" type="text/javascript"></script>
    <script type="text/javascript">
(function (window) {
    "use strict";
    window.TESTSUITE(window);
    var self = {
        diameter: 400
    };
    var origin = [self.diameter / 2, self.diameter / 2];
    var rad2deg = (180/Math_PI);

    $(function () {

        var canvas = document.createElement('canvas');
        canvas.width = 400;
        canvas.height = 400;
        canvas.style.display = 'block';
        self.canvases = [$(canvas).clone().appendTo('body')[0]];
        var startTime = new Date();
        test1(self);
        var duration = new Date() - startTime;
        $('body').append(duration+" mS<br/>")
        self.canvases = [$(canvas).clone().appendTo('body')[0]];
        startTime = new Date();
        test2(self);
        duration = new Date() - startTime;
        $('body').append(duration+" mS<br/>")
        self.canvases = [$(canvas).clone().appendTo('body')[0]];
        startTime = new Date();
        test3(self);
        duration = new Date() - startTime;
        $('body').append(duration+" mS<br/>")
    });

    function drawPart(imageData, startX, endX, startY, endY) {
        for (i = startX; i < endX; i++) {
            x = i - origin[0];
            for (j = startY; j < endY; j++) {
                y = j - origin[1];
                degree = Math_atan2(x, y) * rad2deg + 270;
                r = getValue(degree + 120);
                g = getValue(degree);
                b = getValue(degree + 240);
                setPixel(imageData, i, j, [r, g, b, 255]);
            }
        }
    }
    function getValue(degree) {
        degree %= 360;
        if (degree >= 240) {
            return 0;
        } else if (degree >= 180) {
            return 255 * ((240 - degree) / 60);
        } else if (degree >= 60) {
            return 255;
        }
        return 255 * (degree / 60);
    }
    function test1(self) {
        var diameter = self.diameter;
        var ctx = self.canvases[0].getContext("2d");
        var imageData = ctx.createImageData(diameter, diameter);
        var lineWidth = 18;
        var blur = 10;
        var circleRadius = (diameter / 2) - 15;
        var degree, i, j, x, y, r, g, b, rad2deg = (180/Math_PI);
        var origin = [self.diameter / 2, self.diameter / 2];
        var deg = Math_PI*5/4;
        var radius = circleRadius - lineWidth / 2 - 2;
        var squarePoint1 = roundPoint(getPointOnCircle(radius, deg, diameter/2));
        var squarePoint2 = roundPoint(getPointOnCircle(radius, deg + Math_PI,  diameter/2));
       // drawPart(0, diameter, 0, diameter)
        drawPart(imageData, 0, diameter, 0, squarePoint1[1]);
        drawPart(imageData, 0, diameter, squarePoint2[1], diameter);
        drawPart(imageData, 0, squarePoint1[0], squarePoint1[1], diameter - squarePoint1[1]);
        drawPart(imageData, squarePoint2[0], diameter, squarePoint1[1], diameter - squarePoint1[1]);
        // copy the image data back onto the canvas
        ctx.putImageData(imageData, 0, 0); // at coords 0,0
    }

    function test2(self) {
        var diameter = self.diameter;
        var ctx = self.canvases[0].getContext("2d");
        var imageData = ctx.createImageData(diameter, diameter);
        var lineWidth = 18;
        var blur = 10;
        var circleRadius = (diameter / 2) - 15;
        var degree, i, j, x, y, r, g, b, rad2deg = (180/Math_PI);
        var origin = [self.diameter / 2, self.diameter / 2];
        var deg = Math_PI*5/4;
        var radius = circleRadius - lineWidth / 2 - 2;
        var squarePoint1 = roundPoint(getPointOnCircle(radius, deg, diameter/2));
        var squarePoint2 = roundPoint(getPointOnCircle(radius, deg + Math_PI,  diameter/2));
       // drawPart(0, diameter, 0, diameter)
        drawPart(imageData, 0, diameter, 0, squarePoint1[1]);
        drawPart(imageData, 0, diameter, squarePoint2[1], diameter);
        drawPart(imageData, 0, squarePoint1[0], squarePoint1[1], diameter - squarePoint1[1]);
        drawPart(imageData, squarePoint2[0], diameter, squarePoint1[1], diameter - squarePoint1[1]);
        // copy the image data back onto the canvas
        ctx.putImageData(imageData, 0, 0); // at coords 0,0
        // cut out doughnut
        /** webkit bug prevents usage of "destination-in" */
        ctx.globalCompositeOperation = "destination-out";
        ctx.strokeStyle = "rgba(0,0,0,1)";
        ctx.lineWidth = lineWidth;
        ctx.beginPath();
        ctx.arc(origin[0], origin[1], circleRadius - 8, 0, Math_PI*2, false);
        ctx.closePath();
        ctx.fill();
        ctx.globalCompositeOperation = "source-over";
    }

    function test3(self) {
        var diameter = self.diameter;
        var ctx = self.canvases[0].getContext("2d");
        var imageData = ctx.createImageData(diameter, diameter);
        var lineWidth = 18;
        var blur = 10;
        var circleRadius = (diameter / 2) - 15;
        var degree, i, j, x, y, r, g, b, rad2deg = (180/Math_PI);
        var origin = [self.diameter / 2, self.diameter / 2];
        var deg = Math_PI*5/4;
        var radius = circleRadius - lineWidth / 2 - 2;
        var squarePoint1 = roundPoint(getPointOnCircle(radius, deg, diameter/2));
        var squarePoint2 = roundPoint(getPointOnCircle(radius, deg + Math_PI,  diameter/2));
       // drawPart(0, diameter, 0, diameter)
        drawPart(imageData, 0, diameter, 0, squarePoint1[1]);
        drawPart(imageData, 0, diameter, squarePoint2[1], diameter);
        drawPart(imageData, 0, squarePoint1[0], squarePoint1[1], diameter - squarePoint1[1]);
        drawPart(imageData, squarePoint2[0], diameter, squarePoint1[1], diameter - squarePoint1[1]);
        // copy the image data back onto the canvas
        ctx.putImageData(imageData, 0, 0); // at coords 0,0
        // cut out doughnut
        /** webkit bug prevents usage of "destination-in" */
        ctx.globalCompositeOperation = "destination-out";
        ctx.strokeStyle = "rgba(0,0,0,1)";
        ctx.lineWidth = lineWidth;
        ctx.beginPath();
        ctx.arc(origin[0], origin[1], circleRadius - 8, 0, Math_PI*2, false);
        ctx.closePath();
        ctx.fill();
        ctx.lineWidth = circleRadius * 2 - 16;
        ctx.beginPath();
        ctx.arc(origin[0], origin[1], circleRadius * 2, 0, Math_PI*2, false);
        ctx.closePath();
        ctx.stroke();
        ctx.globalCompositeOperation = "source-over";
    }
})(window);
    </script>
    <style type="text/css">
        body {
            margin: 2em;
            background: #adf;
        }
    </style>
</head>
<body>

</body>
</html>
